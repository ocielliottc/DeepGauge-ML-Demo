{% extends 'base.html' %}
{% block content %}
<div id="content">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a href="{{ url_for('root') }}">
        <i class="fas fa-chevron-left"></i>
        Back to Dashboard
      </a>
    </div>
  </nav>
  <article class="container-fluid">
    <section class="row">
      <div class="container">
        <div class="col">
          <div class="col-md-6 col-md-offset-2">
          <h2>
            {% if device.name == "" %}
            Device {{ device.id }}
            {% else %}
            {{ device.name }}
            {% endif %}
            <a class="float-right" href = {{ url_for('show_device_setting', device_id=device.id) }}>
              <i class="fas fa-cog"></i>
            </a>
          </h2>
          </div>
        </div>
        <div class="col row">
          <div class="card col-md-6" style="width: 22rem;">
            <img class="card-img-top" src="{{device.image}}" alt="Device Image">
            <div class="card-body">
                <canvas id="myChart" responsive="true" height="100"></canvas>
                <hr />
                <p class="d-flex justify-content-between align-items-center">
                  Prediction
                  <span class="badge badge-primary badge-pill">{{ device.prediction }}</span>
                </p>
                <p class="d-flex justify-content-between align-items-center">
                  Probability
                  <span class="badge badge-primary badge-pill">{{reading.accuracy}}</span>
                </p>
                <p class="d-flex justify-content-between align-items-center">
                  Device Type:
                  <span class="badge badge-primary">{{device.type}}</span>
                </p>
                <p class="d-flex justify-content-between align-items-center">
                  Location:
                  <span class="badge badge-primary">{{device.location}}</span>
                </p>
                <strong class="card-text">Notes</strong>
                <p class="card-text mb-5">{{device.notes}}</p>
              </div>
          </div>
          <div class="col-md-6 col-md-offset-2">
            <textarea class="form-control" rows="3" readonly="true">
{% for message in messages %}{{ message }}
{% endfor %}</textarea>
          </div>
        </div>
      </div>

    </section>
  </article>
</div>
{% endblock %}

{% block script %}
<script>
  function loadData(labels, data, alerts) {
{% for key in rdata['readings'] %}
    labels.push('{{ key }}');
    data.push({% if rdata['readings'][key][0] == "nan" %}NaN{% else %}{{ rdata['readings'][key][0] }}{% endif %});
    alerts.push({% if rdata['readings'][key][1] %}{{ rdata['readings'][key][0] }}{% else %}NaN{% endif %});
{% endfor %}
    return ['{{ rdata['date'] }}', '{{ rdata['units'] }}'];
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<script src="{{ url_for('static', filename='chart-script.js') }}"></script>
{% endblock %}
